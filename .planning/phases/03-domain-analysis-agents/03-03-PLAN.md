---
phase: 03-domain-analysis-agents
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - dc-due-diligence-desktop/agents/natural-gas-agent.md
  - dc-due-diligence-desktop/agents/market-comparables-agent.md
autonomous: true
requirements: [DOMAIN-08, DOMAIN-09]

must_haves:
  truths:
    - "Natural Gas agent file exists and contains gas supply, pipeline access, on-site generation, and gas pricing extraction categories"
    - "Market Comparables agent file exists and is heavily weighted toward independent web research (per CLI design — this agent relies less on documents than others)"
    - "Each agent reads only from its own domain key in _dd_inventory.json"
    - "Document Safety Protocol appears at the top of every agent file, verbatim from CLI version"
    - "Market Comparables agent proceeds to web research even when zero documents are assigned (per Pitfall 4)"
  artifacts:
    - path: "dc-due-diligence-desktop/agents/natural-gas-agent.md"
      provides: "Natural Gas domain analysis agent for Cowork"
      contains: "Document Safety Protocol"
    - path: "dc-due-diligence-desktop/agents/market-comparables-agent.md"
      provides: "Market Comparables domain analysis agent for Cowork"
      contains: "Document Safety Protocol"
  key_links:
    - from: "dc-due-diligence-desktop/agents/natural-gas-agent.md"
      to: "_dd_inventory.json"
      via: "Agent reads domains.natural-gas.files[] from inventory"
      pattern: "domains\\.natural-gas\\.files"
    - from: "dc-due-diligence-desktop/agents/market-comparables-agent.md"
      to: "_dd_inventory.json"
      via: "Agent reads domains.market-comparables.files[] from inventory"
      pattern: "domains\\.market-comparables\\.files"
---

<objective>
Port the final 2 domain agents (Natural Gas, Market Comparables) from CLI to Cowork format, completing the full set of 9 domain agents.

Purpose: Completes the Wave 1 agent roster. After this plan, all 9 domain agents are ready for parallel dispatch by the orchestrator.
Output: 2 agent files in dc-due-diligence-desktop/agents/, completing the 9-agent set
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-domain-analysis-agents/03-CONTEXT.md
@.planning/phases/03-domain-analysis-agents/03-RESEARCH.md

# CLI reference agents (read these to port methodology)
@dc-due-diligence/agents/natural-gas-agent.md
@dc-due-diligence/agents/market-comparables-agent.md

# Report template (agents must follow this output format)
@dc-due-diligence/templates/agent-output-template.md

# Pattern reference — use Plan 01 agents as the Cowork adaptation model
@dc-due-diligence-desktop/agents/power-agent.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Natural Gas and Market Comparables agent files</name>
  <files>
    dc-due-diligence-desktop/agents/natural-gas-agent.md
    dc-due-diligence-desktop/agents/market-comparables-agent.md
  </files>
  <action>
Create the final two agent files following the identical adaptation pattern from Plans 01 and 02. Read each CLI reference agent and the Cowork power-agent.md as the structural model.

**Apply the same adaptation rules as Plan 01 Task 1** (same keep/replace/remove/add list).

**Domain-specific details:**
- natural-gas-agent.md: `domains.natural-gas.files[]`, output: `research/natural-gas-report.md`
- market-comparables-agent.md: `domains.market-comparables.files[]`, output: `research/market-comparables-report.md`

**Special note for Natural Gas agent (435 lines in CLI):** This is one of the larger agents. Ensure gas supply agreements, pipeline access, on-site generation feasibility, and gas pricing extraction categories are all preserved with their full keyword lists. The Natural Gas agent has important cross-references to the Power agent (backup generation depends on gas supply) — preserve these cross-domain notes.

**Special note for Market Comparables agent (475 lines in CLI — the largest domain agent):** This agent is fundamentally different from the other 8. Per the CLI agent description: "Unlike most other agents that primarily verify broker claims, your role is heavily weighted toward independent market research — broker documents rarely contain comprehensive market data."

Critical adaptations for Market Comparables:
1. The "if no files assigned" path is ESPECIALLY important here — this domain frequently has zero documents in the data room, and the agent must still produce a comprehensive web-research-driven report
2. The Phase 1/Phase 2 weighting differs: Phase 1 (document claims) may be very thin, while Phase 2 (web research) is the primary value. Preserve this emphasis from the CLI version.
3. The search budget may need to be higher — the CLI version uses 10-20 web searches (vs. 5-15 for most agents). Preserve the CLI's search budget guidance if it differs from other agents.
4. Market Comparables relies heavily on site location context. Add explicit instruction: "Use the workspace folder name and any location information from _dd_inventory.json or other domain documents to establish the geographic market for comparable research."
  </action>
  <verify>
    <automated>
cd /Users/noahrasheta/Dev/GitHub/shipfast && \
for agent in natural-gas market-comparables; do \
  FILE="dc-due-diligence-desktop/agents/${agent}-agent.md"; \
  echo "=== $agent ===" && \
  test -f "$FILE" && echo "EXISTS: yes" || echo "EXISTS: NO" && \
  head -3 "$FILE" | grep -q "^---" && echo "FRONTMATTER: yes" || echo "FRONTMATTER: NO" && \
  grep -q "Document Safety Protocol" "$FILE" && echo "SAFETY: yes" || echo "SAFETY: NO" && \
  grep -q "_dd_inventory.json" "$FILE" && echo "INVENTORY_REF: yes" || echo "INVENTORY_REF: NO" && \
  grep -q "WORKSPACE_FOLDER" "$FILE" && echo "WORKSPACE_VAR: yes" || echo "WORKSPACE_VAR: NO" && \
  (grep -q "_converted" "$FILE" && echo "CONVERTED_REF: FAIL" || echo "NO_CONVERTED: yes") && \
  (grep -qi "ToolSearch\|firecrawl\|tavily\|exa" "$FILE" && echo "MCP_REF: FAIL" || echo "NO_MCP: yes"); \
done && \
echo "=== Market Comparables web research emphasis ===" && \
grep -q "web research" "dc-due-diligence-desktop/agents/market-comparables-agent.md" && echo "WEB_RESEARCH_EMPHASIS: yes" || echo "WEB_RESEARCH_EMPHASIS: NO" && \
echo "=== Full agent roster check ===" && \
AGENT_COUNT=$(ls dc-due-diligence-desktop/agents/*-agent.md 2>/dev/null | wc -l | tr -d ' ') && \
echo "Total agents: $AGENT_COUNT (expected: 9)"
    </automated>
  </verify>
  <done>
natural-gas-agent.md and market-comparables-agent.md exist in dc-due-diligence-desktop/agents/ with complete Cowork adaptation. Market Comparables agent emphasizes web research as primary value driver and handles zero-document scenarios. All 9 domain agent files are now present in the agents/ directory.
  </done>
</task>

</tasks>

<verification>
Final Phase 3 verification:
1. All 9 agent files exist in dc-due-diligence-desktop/agents/
2. Every agent has: YAML frontmatter, Document Safety Protocol, two-phase workflow, inventory-based file reading, no legacy references
3. Orchestrator dispatch logic (from Plan 01) covers all 9 domains
4. Agent count matches expected: 9 files (power, connectivity, water-cooling, land-zoning, ownership, environmental, commercials, natural-gas, market-comparables)
</verification>

<success_criteria>
- 2 agent files created: natural-gas-agent.md, market-comparables-agent.md
- Full roster of 9 domain agent files present in dc-due-diligence-desktop/agents/
- Market Comparables agent handles zero-document scenario with web-research-only path
- Validation script passes clean for both agents
- Total agent count confirmed at 9
</success_criteria>

<output>
After completion, create `.planning/phases/03-domain-analysis-agents/03-03-SUMMARY.md`
</output>
