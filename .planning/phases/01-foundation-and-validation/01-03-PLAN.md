---
phase: 01-foundation-and-validation
plan: 03
type: execute
wave: 3
depends_on:
  - "01-02"
files_modified:
  - dc-due-diligence-desktop/commands/due-diligence.md
  - dc-due-diligence-desktop/skills/due-diligence/SKILL.md
  - .planning/STATE.md
autonomous: false
requirements:
  - PLAT-01
  - PLAT-02

must_haves:
  truths:
    - "Empirical test determines whether Cowork supports parallel sub-agent dispatch (Task tool) — result is documented, not assumed"
    - "Two stub sub-agents are dispatched and their execution timing is observable via timestamps in output files"
    - "Sequential fallback orchestration executes all steps correctly regardless of parallel dispatch availability"
    - "Architecture decision is recorded in STATE.md with empirical evidence (timestamps, observations)"
  artifacts:
    - path: ".planning/STATE.md"
      provides: "Architecture decision on parallel vs sequential dispatch"
      contains: "parallel dispatch"
    - path: "dc-due-diligence-desktop/commands/due-diligence.md"
      provides: "Updated orchestrator with confirmed dispatch pattern"
      contains: "sequential"
    - path: "dc-due-diligence-desktop/skills/due-diligence/SKILL.md"
      provides: "Updated skill with confirmed architecture"
      contains: "dispatch"
  key_links:
    - from: "Smoke test results (agent-a-done.txt, agent-b-done.txt)"
      to: ".planning/STATE.md"
      via: "Timestamp comparison determines parallel vs sequential finding"
      pattern: "timestamp.*parallel|sequential"
    - from: "Architecture decision"
      to: "dc-due-diligence-desktop/skills/due-diligence/SKILL.md"
      via: "SKILL.md updated to reflect confirmed dispatch pattern"
      pattern: "sequential|parallel"
---

<objective>
Run the parallel dispatch smoke test inside Cowork — dispatch two stub sub-agents, observe whether they execute concurrently or sequentially, and record the architecture decision.

Purpose: This is the single load-bearing unknown for the entire project. Phase 3 Wave 1 architecture (9 parallel domain agents vs sequential execution) depends on this result. Do not proceed to Phase 2 without answering this question.
Output: Empirical smoke test results with timestamps, architecture decision recorded in STATE.md, orchestrator updated with confirmed dispatch pattern.
</objective>

<execution_context>
@/Users/noahrasheta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/noahrasheta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-and-validation/01-RESEARCH.md
@.planning/phases/01-foundation-and-validation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and run the parallel dispatch smoke test</name>
  <files>
    dc-due-diligence-desktop/commands/due-diligence.md
    dc-due-diligence-desktop/skills/due-diligence/SKILL.md
  </files>
  <action>
**Design the smoke test inside the orchestrator command/skill:**

Add a temporary smoke test section to `commands/due-diligence.md` (or create a dedicated `commands/smoke-test.md` if the confirmed invocation format supports multiple commands). The smoke test must:

1. **Dispatch two stub sub-agents simultaneously.** Use whatever dispatch mechanism is available in Cowork:
   - First attempt: Use the Task tool to spawn two sub-agents in parallel (this is the hypothesis being tested)
   - Each sub-agent has a simple job: sleep for 5 seconds, then write a file with a timestamp

2. **Sub-agent A instructions:**
   - Wait 5 seconds (use `sleep 5` via bash)
   - Write `agent-a-done.txt` to the workspace folder with content: `Agent A completed at: <ISO timestamp>`

3. **Sub-agent B instructions:**
   - Wait 5 seconds (use `sleep 5` via bash)
   - Write `agent-b-done.txt` to the workspace folder with content: `Agent B completed at: <ISO timestamp>`

4. **Orchestrator observes results:**
   - After both agents complete, read both files
   - Compare timestamps:
     - If timestamps are within 2 seconds of each other -> PARALLEL confirmed
     - If agent-b-done.txt timestamp is 5+ seconds after agent-a-done.txt -> SEQUENTIAL confirmed
   - Report the finding to the user with the raw timestamps

5. **If Task tool is not available** (error on dispatch attempt):
   - Record "Task tool not available in Cowork" as the finding
   - This is a valid result — it means sequential-only architecture for Phase 3

**Sequential fallback validation:**

Regardless of the smoke test result, also validate that sequential dispatch works:
1. Run Sub-agent A instructions directly (without Task tool)
2. Wait for completion
3. Run Sub-agent B instructions directly
4. Verify both output files exist

This confirms the fallback path works even if parallel is available — the project must work sequentially.

**Important:** The smoke test design from research (Pattern 5) is the baseline. Adapt based on what Plan 01-02 revealed about:
- The exact slash command invocation format
- Whether SKILL.md instructions loaded
- What tools are available in the Cowork environment
  </action>
  <verify>
    <automated>test -f dc-due-diligence-desktop/commands/due-diligence.md && grep -q "smoke.test\|agent-a-done\|agent-b-done\|parallel\|sequential" dc-due-diligence-desktop/commands/due-diligence.md && echo "PASS"</automated>
    <manual>Run the smoke test in Cowork and observe the output — confirm timestamps are displayed and the parallel/sequential finding is stated</manual>
  </verify>
  <done>Smoke test logic added to orchestrator. Test dispatches two stub agents with 5-second sleeps. Timestamp comparison determines parallel vs sequential. Sequential fallback is also validated independently.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Run smoke test in Cowork and record architecture decision</name>
  <files>dc-due-diligence-desktop/commands/due-diligence.md</files>
  <action>
Human verification checkpoint. Claude has built the smoke test. The user must run it in Cowork and report results.

What was built:
- Parallel dispatch smoke test: Two stub sub-agents dispatched inside Cowork, each sleeping 5 seconds then writing a timestamped file. Timestamp comparison reveals whether Cowork runs them concurrently (parallel) or one-at-a-time (sequential).

How to verify:
1. Open Cowork with the dc-due-diligence-desktop plugin installed (from Plan 01-02)
2. If the plugin needs re-uploading (updated files), re-ZIP and re-upload
3. Run the smoke test command (use the invocation format confirmed in Plan 01-02)
4. Wait for both sub-agents to complete
5. Check the workspace for `agent-a-done.txt` and `agent-b-done.txt`
6. Compare timestamps:
   - Within 2 seconds = PARALLEL
   - 5+ seconds apart = SEQUENTIAL
   - Task tool error = SEQUENTIAL (Task tool unavailable)
7. Report the finding:
   - "parallel" — both agents ran concurrently
   - "sequential" — agents ran one at a time
   - "task-tool-unavailable" — Task tool errored, sequential only
8. Also confirm the sequential fallback (direct execution without Task tool) works

After confirming the result, Claude will:
- Update `.planning/STATE.md` with the architecture decision under Decisions
- Update the orchestrator SKILL.md to reflect the confirmed dispatch pattern
- Remove the smoke test scaffolding (temporary files) from the plugin

Resume signal: Type the result: "parallel", "sequential", or "task-tool-unavailable" — with any additional observations.
  </action>
  <verify>User reports parallel dispatch test result with timestamp evidence or error messages</verify>
  <done>Parallel vs sequential dispatch empirically determined. Result reported with evidence. Ready for Task 3 to record the decision.</done>
</task>

<task type="auto">
  <name>Task 3: Record architecture decision and update orchestrator</name>
  <files>
    .planning/STATE.md
    dc-due-diligence-desktop/commands/due-diligence.md
    dc-due-diligence-desktop/skills/due-diligence/SKILL.md
  </files>
  <action>
Based on the smoke test result from Task 2:

**Update .planning/STATE.md** — Add to the Decisions section:

```
- [Phase 1, Plan 03]: Parallel sub-agent dispatch in Cowork: {RESULT}
  Evidence: agent-a-done.txt timestamp {A_TIME}, agent-b-done.txt timestamp {B_TIME}, delta {DELTA}s
  Impact: Phase 3 Wave 1 will use {parallel 9-agent dispatch | sequential 9-agent chain}
  Date: {today}
```

Also update the Blockers/Concerns section — resolve the Phase 1 dependency blocker:
```
- [RESOLVED] [Phase 1 dependency]: Parallel dispatch result: {RESULT}. Phase 3 architecture confirmed.
```

**Update orchestrator files** — Based on result:

If PARALLEL:
- SKILL.md: Document that Task tool is available. Phase 3 will dispatch 9 domain agents in parallel.
- commands/due-diligence.md: Note parallel dispatch is confirmed.

If SEQUENTIAL:
- SKILL.md: Document sequential-only execution. Phase 3 will dispatch 9 domain agents one at a time.
- commands/due-diligence.md: Note sequential execution path.

**Clean up smoke test artifacts:**
- Remove the temporary smoke test section from the command/skill files
- Remove `agent-a-done.txt` and `agent-b-done.txt` instructions (these were test-only)
- Keep the file discovery and session resilience logic intact
  </action>
  <verify>
    <automated>grep -q "Parallel sub-agent dispatch" .planning/STATE.md && grep -q "RESOLVED" .planning/STATE.md && echo "PASS"</automated>
    <manual>Verify STATE.md has the architecture decision with empirical evidence and the Phase 1 blocker is marked resolved</manual>
  </verify>
  <done>Architecture decision recorded in STATE.md with empirical evidence. Orchestrator updated to reflect confirmed dispatch pattern. Smoke test scaffolding removed. Phase 1 blocker resolved.</done>
</task>

</tasks>

<verification>
1. Smoke test ran in Cowork and produced timestamp evidence
2. Parallel vs sequential finding is documented with raw data
3. STATE.md Decisions section updated with finding and evidence
4. STATE.md Blockers/Concerns section has Phase 1 dependency resolved
5. Orchestrator files updated to reflect confirmed architecture
6. Smoke test scaffolding removed — plugin is clean for Phase 2
7. Sequential fallback confirmed working regardless of parallel result
</verification>

<success_criteria>
- The parallel dispatch question is answered empirically — no assumptions remain
- Evidence (timestamps or error messages) is recorded in STATE.md
- Orchestrator files reflect the confirmed dispatch pattern
- Sequential execution path is validated and working
- Phase 3 Wave 1 architecture is unblocked
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-and-validation/01-03-SUMMARY.md`
</output>
